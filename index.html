<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,width=device-width">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css">
  <script src="js/jquery-1.8.3.min.js"></script>
  <script src="js/jquery.mobile-1.3.2.min.js"></script>
  <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=fdb3896c62975b8b3dbec45aafec35a4"></script>

  <script type="text/javascript">
  function initialize(){
    var mapHeight = parseInt($("#header").css("height"));
    mapHeight = document.body.clientHeight - mapHeight;
    $("#container").css("height",mapHeight+"px");

    isMapOpen = false;

    $(document).ready(function(){
      $("#upload").click(function(){
        var form = document.forms["student-info"];
        var school = form["school"];
        var data = {};
        data._name="tx";
        data._address = school;
        data.fullname = form["fullname"];
        data.school = school;
        data.number = form["number"];
        form["data"].value = JSON.stringify(data);

        var formData = $("#student-info").serialize();


                    $.ajax({
                      type: "POST",
                      url: "http://yuntuapi.amap.com/datamanage/data/create",
                      data: formData,
                      cache:false,
                      success:function(data){
                        var result = JSON.parse(data);
                        alert(result.info);
                        $.mobile.changePage("index.html");
                      }
                });

      });
    });

  }

  function init_map()
  {
    isMapOpen = true;
    $("#container").html("");
    var position=new AMap.LngLat(107.750313,38.798736);
    mymap=new AMap.Map("container",{
      view: new AMap.View2D({//创建地图二维视口
        center:position,//创建中心点坐标
        zoom:4, //设置地图缩放级别
        rotation:0 //设置地图旋转角度
      }),
      lang:"zh_cn"//设置地图语言类型，默认：中文简体
    });//创建地图实例
  }

  </script>

</head>

<body onload="initialize()">
  <div data-role="page" id="page-init">

    <div data-role="header" id="header">
      <a href="#page-upload" data-role="button" data-icon="plus">上传</a>
      <h1>2015届17班</h1>
      <a href="#page-search" data-role="button" data-icon="search">搜索</a>
    </div>


    <div id="container">
      <a data-role="button" onclick="init_map()">打开地图</a>
    </div>

    <div data-role="footer" data-position="fixed" id="footer">
    <h1>页脚文本10</h1>
    </div>


  </div>

  <div data-role="page" id="page-upload">

      <div data-role="header" id="header">
        <h1>上传新信息</h1>
      </div>


      <div id="container">
        <form id="student-info" name="student-info">
          <div data-role="fieldcontain">

            <label for="fullname">姓名</label>
            <input type="text" name="fullname" id="fullname" placeholder="真实姓名"/>

            <label for="number">电话号码</label>
            <input type="text" name="number" id="number" placeholder="联系方式"/>

            <label for="school">就读学校</label>
            <input type="text" name="school" id="school" value=""/>

            <input type="hidden" name="key" value="4968b91cb8725bf026cbf5c6a9a833e4"/>
            <input type="hidden" name="tableid" value="55c715c2e4b05d86ecef1a1f"/>
            <input type="hidden" name="loctype" value="2"/>
            <input type="hidden" name="data" value="">

            <button id="upload" type="submit">上传</button>

          </div>
        </form>
      </div>

  </div>

</body>
</html>
