<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,width=device-width">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css">
  <script src="js/jquery-1.8.3.min.js"></script>
  <script src="js/jquery.mobile-1.3.2.min.js"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=CzGOPnVbyB85ZGs6wppKFRNt"></script>

  <script type="text/javascript">
  function initialize(){
    var mapHeight = parseInt($("#header").css("height"))+parseInt($("#footer").css("height"));
    mapHeight = document.body.clientHeight - mapHeight;
    $("#container").css("height",mapHeight+"px");

    isMapOpen = false;

  }

  function init_map()
  {
    isMapOpen = true;
    $("#container").html("");
    var map = new BMap.Map("container");          // 创建地图实例
    var point = new BMap.Point(107.750313,38.798736);  // 创建点坐标
    map.centerAndZoom(point, 5);                 // 初始化地图，设置中心点坐标和地图级别
  }

  function my_upload()
  {
    var myGeo = new BMap.Geocoder();
    var student = document.forms["student-info"];

    myGeo.getPoint(student.elements["school"].value,function(point){
      if(point)
      {
        student.elements["longitude"].value = point.lng;
        student.elements["latitude"].value = point.lat;

        $.ajax({
                type: "post",
                url: "http://api.map.baidu.com/geodata/v3/poi/create",
                data: $("#student-info").serialize(),
                success: function(data) {
                    //var r = JSON.parse(data);
                    alert("上传成功!");
                },
                error: function(data) {
              //    var r = JSON.parse(data);
                  alert("上传成功!");
                }
            });
      }
      else {
        alert("请正确输入信息!");
        return;
      }
    },"全国");

  }


  </script>

</head>

<body onload="initialize()">
  <div data-role="page" id="page-init">

    <div data-role="header" id="header">
      <a href="#page-upload" data-role="button" data-icon="plus" data-transition="flow" data-direction="reverse">上传</a>
      <h1>2015届17班</h1>
      <a href="#page-search" data-role="button" data-icon="search">搜索</a>
    </div>


    <div id="container">
      <a data-role="button" onclick="init_map()">打开地图</a>
    </div>

    <div data-role="footer" id="footer">
      <div data-role="controlgroup" data-type="horizontal">
        <a data-role="button" onclick="putMakers()">同学分布</a>
        <a data-role="button" onclick="">地区热度</a>
        <a data-role="button" onclick="">恢复默认</a>
  </div>
    </div>


  </div>

  <div data-role="page" id="page-upload">

      <div data-role="header" id="header">
        <h1>上传新信息</h1>
        <a href="#page-init" data-role="button" data-icon="arrow-r" class="ui-btn-right" data-transition="flow">返回</a>
      </div>


      <div id="container">
        <form id="student-info" name="student-info">
          <div data-role="fieldcontain">

            <label for="fullname">姓名</label>
            <input type="text" name="fullname" id="fullname" placeholder="真实姓名"/>

            <label for="number">电话号码</label>
            <input type="text" name="number" id="number" placeholder="联系方式"/>

            <label for="school">就读学校</label>
            <input type="text" name="school" id="school" value=""/>

            <input type="hidden" name="ak" value="CzGOPnVbyB85ZGs6wppKFRNt"/>
            <input type="hidden" name="geotable_id" value="115139"/>
            <input type="hidden" name="coord_type" value="3"/>
            <input type="hidden" name="latitude" value="11">
            <input type="hidden" name="longitude" value="105">
            <input type="hidden" name="tags" value="tx">

            <a data-role="button" data-icon="plus" data-inline="true" onclick="my_upload()">上传</a>

          </div>
        </form>
      </div>

  </div>

</body>
</html>
